# AutoPOI 打包构建指南

## 📋 JDK 版本要求

不同模块对 JDK 版本有严格要求：

| 模块 | 编译 JDK | 运行 JDK | 说明 |
|------|---------|---------|------|
| `autopoi` | **JDK 8+** | JDK 8+ | 核心模块，使用 JDK 8 API |
| `autopoi-spring-boot-2-starter` | **JDK 8+** | JDK 8+ | Spring Boot 2.x 兼容 |
| `autopoi-spring-boot-3-starter` | **JDK 17+** | JDK 17+ | Spring Boot 3.x 要求 |

## 🔧 关键配置：`<release>` 参数

项目中使用了 `<release>` 参数来严格控制 API 版本：

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <configuration>
        <release>8</release>  <!-- autopoi 和 spring-boot-2-starter -->
        <!-- 或 -->
        <release>17</release> <!-- spring-boot-3-starter -->
    </configuration>
</plugin>
```

**这个参数的神奇之处：**
- ✅ **即使你在 IDEA 中选择了 JDK 17，编译时也只能使用 JDK 8 的 API**
- ✅ 如果代码中使用了 JDK 9+ 的 API（如 `List.of()`），编译会直接失败
- ✅ 生成的字节码与指定的 JDK 版本兼容

## 🚀 推荐的打包方式

### 方式一：使用 Maven 命令行（推荐）

```bash
# 完整构建所有模块
mvn clean install

# 跳过测试快速构建
mvn clean install -DskipTests

# 只构建特定模块
cd autopoi
mvn clean install
```

### 方式二：在 IntelliJ IDEA 中打包

#### ⚠️ 重要提示

由于配置了 `<release>` 参数，**你可以用任何 JDK 版本打包，但每个模块会强制使用对应版本的 API：**

| IDEA 选择的 JDK | autopoi | spring-boot-2-starter | spring-boot-3-starter |
|----------------|---------|---------------------|---------------------|
| JDK 8          | ✅ JDK 8 API | ✅ JDK 8 API | ❌ 需要 JDK 17+ |
| JDK 11         | ✅ JDK 8 API | ✅ JDK 8 API | ❌ 需要 JDK 17+ |
| JDK 17         | ✅ JDK 8 API | ✅ JDK 8 API | ✅ JDK 17 API |

**推荐：使用 JDK 17 打包所有模块！**

#### IDEA 配置步骤

1. 打开 IDEA，点击右上角 Maven 面板
2. 选择 JDK 17（可以构建所有模块）
3. 双击 `Lifecycle` -> `install` 或 `package`

## 🧪 验证构建结果

### 验证字节码版本

```bash
# Windows PowerShell
javap -v autopoi\target\classes\org\jeecgframework\poi\excel\ExcelExportUtil.class | Select-String "major version"
# 输出应该是: major version: 52 (JDK 8)

javap -v autopoi-spring-boot-3-starter\target\classes\org\jeecgframework\poi\view\JeecgEntityExcelView.class | Select-String "major version"
# 输出应该是: major version: 61 (JDK 17)
```

### 检查依赖

```bash
# 验证没有 poi-ooxml-schemas
mvn dependency:tree | findstr poi-ooxml-schemas
# 应该没有输出
```

## ❌ 常见错误

### 错误：使用了 JDK 9+ 的 API

```java
// ❌ 错误：autopoi 模块中使用了 JDK 9 的 API
List<String> list = List.of("a", "b", "c");

// ✅ 正确：使用 JDK 8 兼容的写法
List<String> list = Arrays.asList("a", "b", "c");
```

**编译时会报错：**
```
[ERROR] cannot find symbol: method of(java.lang.String,java.lang.String,java.lang.String)
```

**解决方案：** 修改代码，使用 JDK 8 兼容的 API。

## 📦 发布打包

```bash
# 打包到本地仓库
mvn clean install

# 打包到 Maven 中央仓库（使用 release profile）
mvn clean deploy -P release
```

## 🎯 总结

1. **`<release>` 参数是关键** - 无论用什么 JDK 编译，都只能使用指定版本的 API
2. **推荐使用 JDK 17 打包** - 可以一次性构建所有模块
3. **每个模块的 API 受到严格限制** - autopoi 和 spring-boot-2-starter 只能用 JDK 8 API

## 📚 参考文档

- [Maven Compiler Plugin - release parameter](https://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html#release)
